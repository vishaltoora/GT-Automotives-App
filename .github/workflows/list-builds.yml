name: List Available Builds

on:
  workflow_dispatch:
    inputs:
      count:
        description: 'Number of recent builds to show'
        required: true
        default: '10'
        type: string

jobs:
  list-builds:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # Fetch full history
        
    - name: List recent builds
      run: |
        echo "ğŸ“‹ Recent Builds Available for Deployment"
        echo "========================================"
        echo ""
        
        COUNT=${{ inputs.count }}
        
        echo "ğŸ—ï¸ Last $COUNT commits with build artifacts:"
        echo ""
        
        # Get recent commits
        COMMITS=$(git log --oneline --format="%H %s" -n $COUNT)
        
        echo "$COMMITS" | while IFS=' ' read -r commit_sha commit_msg; do
          # Check if this commit has build artifacts
          git checkout $commit_sha >/dev/null 2>&1
          
          BACKEND_BUILD="âŒ"
          FRONTEND_BUILD="âŒ"
          
          if [ -f "server/dist/main.js" ]; then
            BACKEND_BUILD="âœ…"
          fi
          
          if [ -f "apps/webApp/dist/index.html" ]; then
            FRONTEND_BUILD="âœ…"
          fi
          
          # Get commit date
          COMMIT_DATE=$(git show -s --format="%ci" $commit_sha)
          
          echo "ğŸ“¦ $commit_sha"
          echo "   ğŸ“… $COMMIT_DATE"
          echo "   ğŸ“ $commit_msg"
          echo "   ğŸ–¥ï¸  Backend: $BACKEND_BUILD   ğŸŒ Frontend: $FRONTEND_BUILD"
          echo ""
        done
        
        echo ""
        echo "ğŸ’¡ To deploy a specific build:"
        echo "   1. Go to 'Simple Deploy' workflow"
        echo "   2. Click 'Run workflow'"
        echo "   3. Enter the commit SHA (8-character short SHA works)"
        echo "   4. Or use 'latest' for most recent commit"
        echo ""
        echo "ğŸ“ Legend:"
        echo "   âœ… = Build artifacts available"
        echo "   âŒ = Build artifacts missing (run build first)"